language: cpp
os: linux
sudo: required
dist: trusty

env:
  global:
    - secure: "jP3xxCcXvjsqP8Oz0TcfaQPyGwS1QGN4Fai/w4ietZt6niu9iaCoewqHsr1P7d/2KtoBNfkyNl8eU51WUpl+49WrZgpsYVFgg20h6ThZtvMH2PWAk4VfsUJFAMZ3hzF4tYtlhBZz2gQLpGnPJbi4OET41upUnc03fZ074w8E40jBmnXTEASIP5L6/nCthr7bz1g0a9s/2oe53pHSvAe+BtGsdFMFXLrBPbAhilWXHlSYMWI5sKbRFd5bEErrbOsyht4PCcEnBURqIEIgQSj62TroV+K4mHxHWQmjF3d/YRo7to2rO2wFqbmTK3NdY92kBMkKEjQ2ayHncHSJ6VOgBbkjFu6+oGyrHTzDBnQAsJ0WCMqLm2Uw9iUaFGaeuZptJzs0kjj4ZqGQkEFMvCyjiyD+UuNvfh/ewG+Ag/EXqM7b+37SeiE4j1CzO53m6ivxW1duRCw2/taB6HBfe6aTazz6+1JBJbbTPpap8wnRRM1z+T97zeGAXu6jbhnq7knuDFEIcUHmwkiR64JR2ucbbJT2s3iSMZ3dhmkCmo23JBFOrk3BNAjn4AsRL3xZ8G5WZ6P9reR/WPu4tc31//kihFl/Gn/p9WD3GF4m2eiFAjtxPTrczGWeYhTT3EhuQSzhMHcnayQOURtsnBtGZ8pqtjt/3uo5/5B+hx3/lxrAWHw="

addons:
  #apt:
  #  sources:
  #    - ubuntu-toolchain-r-test
  #  packages:
  #    - g++-4.8
  #    - cmake
    coverity_scan:
      project:
        name: "Bo-Yuan-Huang/SimpleAPI"
        description: "C++ project template"
      notification_email: byhuang1992@gmail.com
      build_command_prepend: "mkdir -p build; cd build; cmake -Dcoverage=ON .."
      build_command:   "make"
      branch_pattern: coverity_scan

before_install:
  # coverity
  - echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
  - sudo apt-get update -qq

install:
  - gem install coveralls-lcov	
  - sudo apt-get install cmake cmake-data
  - sudo apt-get install liblapack-dev libblas-dev libboost-dev libarmadillo-dev
  # install newer LCOV (1.9 was failing)
  #- wget http://ftp.de.debian.org/debian/pool/main/l/lcov/lcov_1.11.orig.tar.gz
  #- tar xf lcov_1.11.orig.tar.gz
  #- sudo make -C lcov-1.11/ install
  - sudo apt-get install lcov

before_script:
  - lcov --version
  - gcov --version
  - g++ --version
  - PARENTDIR=$(pwd)
  - mkdir $PARENTDIR/build && cd $PARENTDIR/build
  - lcov --directory $PARENTDIR/build --zerocounters

script:
  - cd $PARENTDIR/build
  - cmake -Dcoverage=ON -DCMAKE_CXX_COMPILER=$COMPILER $PARENTDIR
  - make
  - make gtest

after_success:
  - lcov --directory $PARENTDIR/build --capture --output-file coverage.info # capture coverage info
  - lcov --remove coverage.info 'tests/*' 'app/*' 'external/*' 'cmake/*' '/usr/*' --output-file coverage.info # filter out system and test code
  - lcov --list coverage.info # debug before upload
  - coveralls-lcov coverage.info #--repo-token _____ coverage.info # uploads to coveralls

notifications:
  email: false
